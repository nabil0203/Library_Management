{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}{{ book.title }}{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-b from-orange-900 via-red-900 to-pink-900 py-10 px-4 flex justify-center">
  <div class="w-full max-w-5xl grid grid-cols-1 lg:grid-cols-2 gap-8">

    <!-- Left Column: Book Details -->
    <div class="bg-black/20 backdrop-blur-lg border border-white/10 rounded-3xl shadow-2xl overflow-hidden">
      {% if book.cover_image %}
        <img src="{{ book.cover_image.url }}" alt="{{ book.title }}" class="w-full h-96 object-cover">
      {% endif %}
      <div class="p-6 space-y-4 text-gray-200">
        <h1 class="text-4xl font-bold text-white">{{ book.title }}</h1>
        <p class="text-gray-300">{{ book.description }}</p>
        <div class="space-y-1">
          <p><strong>Category:</strong> {{ book.category.name }}</p>
          <p><strong>Authors:</strong> {{ book.authors.all|join:", " }}</p>
          <p><strong>Views:</strong> {{ book.view_content }}</p>
          <p><strong>Tags:</strong>
            {% for t in book.tag.all %}
              <span class="inline-block bg-yellow-700/50 text-white px-3 py-1 rounded-full text-sm mr-1">{{ t.name }}</span>
            {% endfor %}
          </p>
        </div>
        <div class="flex gap-3 mt-4">
          <a href="{% url 'book_update' book.id %}" class="flex-1 px-4 py-2 bg-yellow-700 hover:bg-yellow-600 text-white font-semibold rounded-xl text-center shadow-md hover:shadow-yellow-600/50 transition-all duration-300">Edit</a>
          <a href="{% url 'book_delete' book.id %}" class="flex-1 px-4 py-2 bg-red-700 hover:bg-red-600 text-white font-semibold rounded-xl text-center shadow-md hover:shadow-red-600/50 transition-all duration-300">Delete</a>
        </div>
      </div>
    </div>

    <!-- Right Column: Comments -->
    <div class="bg-black/20 backdrop-blur-lg border border-white/10 rounded-3xl shadow-2xl p-6 space-y-6 text-gray-200">
      <h2 class="text-3xl font-semibold text-white mb-4">Comments</h2>

      <div class="space-y-4 max-h-[600px] overflow-y-auto">
        {% for comment in comments %}
          <div class="bg-black/10 border border-white/10 rounded-xl p-4">
            <div class="flex justify-between items-center">
              <strong>{{ comment.user.username }}</strong>
              <span class="text-gray-400 text-sm">{{ comment.created_at|date:"M d, Y H:i" }}</span>
            </div>
            <p class="mt-2 text-gray-300">{{ comment.content }}</p>
          </div>
        {% empty %}
          <p class="text-gray-400">No comments yet.</p>
        {% endfor %}
      </div>

      {% if user.is_authenticated %}
        <form method="post" class="space-y-4 mt-4">
          {% csrf_token %}
          {{ comment_form|crispy }}
          <button type="submit" class="w-full px-4 py-2 bg-red-700 hover:bg-red-600 text-white font-semibold rounded-xl shadow-md hover:shadow-red-600/50 transition-all duration-300">Add Comment</button>
        </form>
      {% else %}
        <p class="text-gray-400 mt-4"><a href="{% url 'login' %}" class="text-yellow-600 hover:text-yellow-500 underline">Login</a> to comment.</p>
      {% endif %}
    </div>

  </div>
</div>
{% endblock %}
